# FlightDelayProphet
Predicts flight delays in SF bay area

I. Motivation & Impact

Air travel in the San Francisco Bay Area is a vital mode of transportation, yet the unpredictability of flight delays often disrupts travel plans. These delays cause inconvenience, as travelers are unsure whether a flight will be delayed and the duration of the delay, making it challenging to plan effectively. As college students, coordinating arrivals and departures when traveling together can be vital for ensuring safety and increasing productivity. Motivated by the desire to address this uncertainty, we designed "Flight Delay Prophet," a machine learning model designed to predict potential delays for Bay Area travelers. By allowing travelers to foresee delays from the comfort of home, we aim to empower them to make informed decisions and better manage their travel experiences – minimizing disruptions and maximizing time. While the focus of this project is on the Bay Area specifically, we expect that it has the potential to be adapted for other regions in future. Additionally, by integrating “Flight Delay Prophet” with complementary models, such as those predicting airport commute times, we can offer a comprehensive suite of tools for travelers seeking efficient travel management solutions.

II. Data

We integrated two datasets to construct our predictive model. The first dataset, sourced from Kaggle, includes United States domestic flight delay data spanning January 2019 to June 2019. This dataset provides detailed information about each flight, such as temporal data, aircraft details, and distance traveled. Our rationale for integrating this dataset is that by analyzing and transforming these features, we can gain valuable insights that will help us predict flight delays. The second dataset comprises daily weather indicators for each airport and was obtained from the National Centers for Environmental Information. Specifically, we focused on three ZIP codes (94128, 94621, 95110) corresponding to the airport areas in the San Francisco Bay Area, covering the entirety of the year 2019. These ZIP codes are exclusively tied to airport areas, underscoring their relevance to our analysis.

During the data cleaning and preprocessing phase, we executed the following tasks:
Selected flights originating from or destined for airports within the San Francisco Bay Area.
Standardized all dates to a uniform format and sorted the date column in ascending order.
Refined airline arrival and departure times for consistent formatting by implementing leading zero padding, ensuring all times are in a consistent four-digit format. Utilized f-strings, validated times to ensure hours and minutes fall within valid ranges, and converted time strings to datetime objects for easier manipulation when extracting specific data ranges.
Incorporated six new features: ['Date', 'Airline', 'DepTime', 'DepHour', 'ArrDelay', 'DepDelay']. Removed null values, created a new dictionary to make the days of the week more readable.
Integrated the weather dataset with the flight delay dataset, predicated on airport locations. We pruned columns with substantial missing data and extracted city names and airport codes to streamline the merging process.
Implemented two new columns: 'SameDayFlightsperPlane' to track the number of flights a specific plane is scheduled for in a single day, and 'PreviousFlightDelay' to record the delay of the most recent flight that the same plane experienced earlier on the same day.
Used conditional filtering to create a new dataframe where the origin of a flight is one of the three airports in the San Francisco Bay Area: SFO, SJC, or OAK.

III. Analytics Models 

Variance Inflation Factor (VIF)
Our analysis examined multicollinearity using the Variance Inflation Factor (VIF) technique. Initially, we computed VIF values for each independent variable in our dataset, revealing significant multicollinearity issues, as evidenced by infinite VIF values for certain variables. We used an iterative approach to address this problem and systematically removed features with high VIF values, including "Plane_Same_Day_Most_Recent_Flight_TotalDelay" and "Avg_ArrDelay_Before". After each removal iteration, we recalculated VIF values to ensure multicollinearity mitigation. Through this process, we successfully reduced multicollinearity and stabilized our regression models. This meticulous VIF analysis improved the reliability and accuracy of our analytical outcomes.

OLS Linear Regression Modeling
We employed linear regression analysis to model the relationship between departure delays and the explanatory features. Initially, we selected a subset of features deemed relevant for predicting departure delays, excluding columns such as 'DayOfWeek_Monday,' 'Airline_Delta Air Lines Inc.,' 'Origin_OAK,' 'DepHour_0', and 'Month_1'. The model was fitted using Ordinary Least Squares (OLS) regression to minimize the sum of squared residuals between the observed and predicted departure delays. The resulting model exhibited an R-squared value of 0.254, indicating that the selected features could explain approximately 25.4% of the variance in departure delays. The adjusted R-squared value, which considers the number of predictors in the model, was 0.250. Additionally, the F-statistic of 73.51 with a corresponding p-value close to zero suggested that the overall regression model was statistically significant. However, some coefficients associated with individual features had p-values greater than the conventional threshold of 0.05, indicating insignificance. There were some multicollinearity issues observed as indicated by the large condition number of 1.21e+05, suggesting the presence of strong correlations among predictors. Further analysis revealed that certain features, such as 'Plane_Same_Day_Most_Recent_Flight_DepDelay,' 'Avg_DepDelay_Before,' and 'Flights_Before,' exhibited notable coefficients, suggesting their importance in predicting departure delays. Conversely, features like 'Average_Wind_Speed,' 'Precipitation,' and 'Maximum_Temperature' showed relatively weaker associations with departure delays. 

Regression Tree Modeling
For a more exploratory approach to predicting departure delays, we employed a Decision Tree Regressor. Through grid search with cross-validation, we determined the optimal complexity parameter (ccp_alpha) for controlling model complexity. The best ccp_alpha value was found to be 0.0099, leading to the optimal decision tree estimator selection. The decision tree model was then visualized to interpret the splits and decision rules, providing insights into the predictive factors influencing departure delays. Upon evaluating the model's performance on the validation dataset, the decision tree exhibited an Out of Sample R-squared (OSR2) value of -0.3616. Despite this negative OSR2 value, indicating that the model performs worse than a horizontal line, it's worth noting that decision trees are not evaluated solely based on R-squared. Additionally, the Mean Absolute Error (MAE) between the predicted and actual departure delays was 37.1050. While the decision tree model offered insights into departure delay patterns, it may require further refinement to improve its predictive accuracy. The negative OSR2 value suggests that the model may not be suitable for accurately predicting departure delays using the original feature data. Further investigations into feature selection, model tuning, or alternative algorithms may be necessary to build a more robust predictive model.

Logistic Regression Approach

Given the challenges of predicting the exact duration of delays via regression, we refocused our efforts on a classification problem: predicting whether a flight would encounter a significant delay (defined as greater than one hour). This categorical prediction can still offer valuable guidance for travelers. Even without knowing the exact delay length, they can be aware of the need to be timely. We developed a logistic regression model to predict significant flight delays. The target variable, "Significant_DepDelay," was defined as a binary indicator of whether a flight delay would exceed 60 minutes, with "1" indicating significant delays and "0" indicating delays shorter than 60 minutes. Features used in the logistic regression model were consistent with those in the linear regression analysis, ensuring continuity in capturing various flight and weather characteristics. To optimize the model, we employed L1-regularization, which helps identify the most relevant features while penalizing those with less predictive power. This approach reduced the impact of multicollinearity and enhanced model interpretability by focusing on the most impactful variables. Evaluation of the logistic regression model using the validation dataset yielded an accuracy of 83.56%, a precision of 83.14%, a recall of 84.32%, and an F1 score of 83.73%. The confusion matrix indicated a balanced classification of flights across both significant and non-significant delay categories, suggesting reliable predictive performance.

Classification Tree Approach
A decision tree classifier was then used to explore patterns and relationships within the data further. GridSearchCV, combined with cross-validation, was employed to fine-tune the complexity parameter (ccp_alpha), which controls model complexity. We effectively reduced overfitting by selecting the optimal ccp_alpha while maintaining predictive strength. Visualizing the decision tree allowed us to identify key decision rules and gain insights into the feature splits, ultimately providing greater model interpretability. The decision tree classifier was tested on the validation dataset and exhibited an accuracy of 78.91%, a precision of 77.02%, a recall of 81.05%, and an F1 score of 78.98%. The confusion matrix highlighted the distribution of correct and incorrect classifications, revealing the importance of specific features in predicting significant flight delays. The decision tree model's real-world performance was tested on an independent test dataset. The model achieved an accuracy of 77.62%, a precision of 76.23%, a recall of 78.45%, and an F1 score of 77.33%. This shows the model could identify significant delays with reasonable accuracy while maintaining interpretability. Despite the slightly lower scores compared to the validation dataset, the model proved useful in offering travelers accurate predictions to minimize travel disruptions.

Random Forest Approach

To deepen our understanding of the data's predictive aspects, we leveraged a Random Forest approach to forecast flight delay durations.A plot between ccp_alpha and CV R2 indicates that the optimal value of ccp_alpha is around 0.00092. This suggests that some mild pruning improves the model's generalization performance compared to no pruning (ccp_alpha = 0) or extremely aggressive pruning (larger ccp_alpha values). A second plot revealed an increasing trend in CV R2 as the "max_features" value increases from around 2.5 to around 15, after which the curve levels off slightly. The optimal value for the "max_features" parameter is around 15-17, which yields a cross-validated R-squared score of approximately 0.96 (specifically, cross-validated R2 = 0.95995 and out-of-sample R2 = 0.96608). Overall, the results indicate that setting max_features to around 15-17 strikes a good balance between capturing relevant information from the features and avoiding overfitting or unnecessary complexity in the Random Forest model for this particular dataset and problem.

Neural Network Approach
As a challenge we created a neural network model because of its strength in learning complex patterns and relationships in data especially with high dimensionality and non-linearities. Using TensorFlow and Keras, we trained a neural network over 50 epochs, utilizing the input layer of preprocessed data and hidden layers for weighted calculations to observe its performance on the validation set. After training, the model had a MAE of 26.4977 indicating that on average the model’s predictions deviate from the true departure delay values by approximately 26.5 minutes on the validation set. 

IV. Findings & Further Scope

Our analysis found that certain features, such as 'Plane_Same_Day_Most_Recent_Flight_DepDelay,' 'Avg_DepDelay_Before,' and 'Flights_Before,' significantly influenced departure delay predictions, while weather conditions had weaker associations. The decision tree models we created provided clarity by visualizing decision rules but had lower predictive performance than other models. The logistic regression model performed well in classifying significant flight delays (>60 minutes), with an accuracy of 83.56%, precision of 83.14%, recall of 84.32%, and F1 score of 83.73%. The Random Forest model, with optimal hyperparameters (ccp_alpha = 0.00092, max_features = 15-17), demonstrated strong predictive power with a cross-validated R-squared score of approximately 0.96. The neural network model, trained over 50 epochs, achieved a validation MAE of 26.4977, indicating an average deviation of approximately 26.5 minutes from true departure delay values.

While our project initially focused on flight delays in the San Francisco Bay Area, the model's versatility allows for expansion to other regions in the United States by leveraging the customizable nature of our approach with Zip Code data. We should explore techniques that integrate the strengths of various models and provide a more comprehensive evaluation of flight delays. It is important to develop a user-friendly interface or application that displays real-time flight delay information. The UIUX implementation would be crucial for the success of our "Flight Delay Prophet" and could assist travelers in navigating air travel seamlessly.

